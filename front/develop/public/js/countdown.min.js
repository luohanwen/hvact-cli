(function(e,i){typeof exports==="object"&&typeof module!=="undefined"?module.exports=i():typeof define==="function"&&define.amd?define(i):e.countDown=i()})(this,function(){function t(e){this._queue=[];this.stop=false;this._createTimer(e)}t.prototype={constructor:t,_createTimer:function(n){var o=this;var r=true;(function(){var e=new Date;for(var i=0;i<o._queue.length;i++){o._queue[i]()}if(!o.stop){var t=new Date-e;n=r?n:t>n?t-n:n;setTimeout(arguments.callee,n)}})();r=false},add:function(e){this._queue.push(e);this.stop=false;return this._queue.length-1},remove:function(e){this._queue.splice(e,1);if(!this._queue.length){this.stop=true}}};function n(){this._pool={}}n.prototype={constructor:n,getTimer:function(e){var i=this._pool[e];return i?i:this._pool[e]=new t(e)},removeTimer:function(e){if(this._pool[e]){delete this._pool[e]}}};function e(e){var i={unit:{day:true,hour:true,minute:true,second:true},getNowTime:null,fixNow:10*1e3,fixNowDate:false,fixClient:10*1e3,fixClientDate:false,delayTime:1e3,now:(new Date).valueOf(),render:function(e){console.log(e)},end:function(){console.log("the end!")},endTime:(new Date).valueOf()+1*1e3*60};for(var t in i){if(i.hasOwnProperty(t)){this[t]=e[t]||i[t]}}this._fixTimer=null;this._fixNum=null;this._fixClientTimer=null;this._fixClientNum=null;this._msNum=null;this._msTimer=(new n).getTimer(this.delayTime);this.init()}e.prototype={constructor:e,init:function(){var i=this;if(this.fixNowDate){this._fixTimer=new t(this.fixNow);this._fixNum=this._fixTimer.add(function(){i.getNowTime&&i.getNowTime(function(e){i.now=e})})}else if(this.fixClientDate){this._fixClientTimer=new t(this.fixClient);this.firstTime=this.now;this.clientTime=(new Date).getTime();this._fixClientNum=this._fixClientTimer.add(function(){i.now=i.firstTime+((new Date).getTime()-i.clientTime)})}this._msNum=this._msTimer.add(function(){i.now+=i.delayTime;if(i.now>=i.endTime){i.end();i.destroy()}else{i.render(i.getOutString())}})},getOutString:function(){return i(this.endTime,this.now,this.unit)},destroy:function(){this.fixTimer&&this.fixTimer.remove(this._fixNum);this.fixClientTimer&&this.fixClientTimer.remove(this._fixClientNum);this._msTimer.remove(this._msNum);this.fixTimer=null;this.fixClientTimer=null;this._msTimer=null}};function s(e){var i=parseInt(e,10);return i<10?"0"+i:i}function i(e,i,t){var n={};var o={day:24*60*60*1e3,hour:60*60*1e3,minute:60*1e3,second:1e3};var r=0;if(t.day){n.day=s(Math.floor((e-i-r)/o.day));r+=n.day*o.day}if(t.hour){n.hour=s(Math.floor((e-i-r)/o.hour));r+=n.hour*o.hour}if(t.minute){n.minute=s(Math.floor((e-i-r)/o.minute));r+=n.minute*o.minute}if(t.second){n.second=s(Math.floor((e-i-r)/o.second));r+=n.second*o.second}return n}return e});